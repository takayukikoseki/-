<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在庫点検フォーム | VIBE Cafe</title>
    <link rel="stylesheet" href="inventory-style.css">
</head>
<body>
<div class="container">
    <header>
        <h1>在庫点検フォーム</h1>
        <p class="subtitle">【残数表】<br>毎週月曜日（休館日は前倒し）に残数を記入し報告してください。</p>
    </header>

    <div id="form-container">
        <form name="inventory" method="POST" action="/" id="inventory-form" data-netlify="true" target="hidden_iframe">
            <!-- Netlifyでフォームを識別するための隠しフィールド -->
            <input type="hidden" name="form-name" value="inventory">
            <!-- ASCII fields for email body lines (must be inside main form) -->
            <input type="hidden" name="line_01" value="">
            <input type="hidden" name="line_02" value="">
            <input type="hidden" name="line_03" value="">
            <input type="hidden" name="line_04" value="">
            <input type="hidden" name="line_05" value="">
            <input type="hidden" name="line_06" value="">
            <input type="hidden" name="line_07" value="">
            <input type="hidden" name="line_08" value="">
            <input type="hidden" name="line_09" value="">
            <input type="hidden" name="line_10" value="">
            <input type="hidden" name="line_11" value="">
            <input type="hidden" name="line_12" value="">
            <input type="hidden" name="line_13" value="">
            <input type="hidden" name="line_14" value="">
            <input type="hidden" name="line_15" value="">
            <input type="hidden" name="line_16" value="">
            <input type="hidden" name="line_17" value="">
            <input type="hidden" name="line_18" value="">
            <input type="hidden" name="line_19" value="">
            <input type="hidden" name="line_20" value="">
            <input type="hidden" name="line_21" value="">
            <input type="hidden" name="line_22" value="">
            <input type="hidden" name="line_23" value="">
            <input type="hidden" name="line_24" value="">
            <input type="hidden" name="line_25" value="">
            <input type="hidden" name="line_26" value="">
            <input type="hidden" name="line_27" value="">
            <input type="hidden" name="line_28" value="">
            <input type="hidden" name="line_29" value="">
            <input type="hidden" name="line_30" value="">
            
            <ul class="item-list">
            </ul>

            <div class="notes">
                <h2>発注の目安と発注先</h2>
                <p class="order-guideline">各品、在庫が2週間分を切る前に発注してください。（納品に時間が掛かる物もあるため、早めの対応をお願いします）</p>
                <dl class="supplier-list">
                    <dt>★</dt><dd>ユニマット</dd>
                    <dt>●</dt><dd>アスクル</dd>
                    <dt>☆</dt><dd>常務へ依頼</dd>
                </dl>
            </div>
        
        <!-- Netlifyで受信するメールの件名 -->
            <input type="hidden" name="_subject" value="【在庫点検報告】">

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">この内容で報告する</button>
                <button type="reset" class="btn btn-secondary">フォームをクリア</button>
            </div>
        </form>
        <div id="thank-you-message" style="display: none; text-align: center; padding: 40px; font-size: 24px; color: #4CAF50; font-weight: bold;">
            点検ありがとうございました
        </div>
    </div>
</div>
    
    <!-- Hidden fallback form for Netlify detection -->
    <form name="inventory" method="POST" action="/" data-netlify="true" hidden>
        <input type="hidden" name="form-name" value="inventory">
        <input type="text" name="dummy" value="" />
    </form>
    <!-- Hidden iframe for background submission -->
    <iframe name="hidden_iframe" style="display:none"></iframe>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('inventory-form');
            const formContainer = document.getElementById('form-container');
            const thankYouMessage = document.getElementById('thank-you-message');
            
            form.addEventListener('submit', function() {
                // 送信直前に hidden(品名) に数量を同期（未選択は0）
                items.forEach(item => {
                    const sel = document.getElementById(item.id);
                    const hid = document.querySelector(`input[type="hidden"][name="${item.name}"]`);
                    if (hid) hid.value = (sel && sel.value !== '') ? sel.value : '0';
                });
                // ASCII行フィールドへ箇条書きを投入
                const lines = [];
                items.forEach(item => {
                    const sel = document.getElementById(item.id);
                    const qty = (sel && sel.value !== '') ? sel.value : '0';
                    lines.push(`- ${item.name}: ${qty}`);
                });
                for (let i = 1; i <= 30; i++) {
                    const f = form.querySelector(`input[name="line_${String(i).padStart(2,'0')}"]`);
                    if (f) f.value = lines[i-1] || '';
                }
                // 表示は即座にサンクスメッセージ
                form.style.display = 'none';
                thankYouMessage.style.display = 'block';
            });
            
            // --- 在庫アイテムの定義 ---
            const items = [
                { id: 'coffee_vest', name: '★コーヒー豆（ヴｴスト）' },
                { id: 'coffee_bullman', name: '★コーヒー豆（ストロングブレンド）' },
                { id: 'creamy_powder', name: '★クリーミーパウダー' },
                { id: 'cocoa_powder', name: '★ココアパウダー' },
                { id: 'milktea_powder', name: '★ミルクティーパウダー' },
                { id: 'hot_cup_lid', name: '★HOTカップ用の蓋 (1袋50入)' },
                { id: 'sencha', name: '★煎茶' },
                { id: 'black_tea', name: '★紅茶' },
                { id: 'barley_tea', name: '★麦茶' },
                { id: 'corn_soup', name: '★コーンスープ' },
                { id: 'onion_soup', name: '★オニオンスープ' },
                { id: 'cup_3oz', name: '●３オンスカップ (1袋100入)' },
                { id: 'cup_3oz_lid', name: '●３オンスカップ（蓋） (1袋50入)' },
                { id: 'cup_1oz', name: '●１オンスカップ蓋セット (1袋50入)' },
                { id: 'plastic_spoon', name: '●プラスプーン (1袋100入)' },
                { id: 'cup_hot', name: '☆カップ（HOT) (1袋50入)' },
                { id: 'cup_ice', name: '☆カップ（ICE) (1袋50入)' },
                { id: 'ice_cup_lid', name: '☆ICEカップ用の蓋 (1袋100入)' }
            ];

            // --- Dynamically create the list items with dropdowns ---
            const itemList = document.querySelector('.item-list');
            items.forEach(item => {
                const listItem = document.createElement('li');
                
                const label = document.createElement('label');
                label.htmlFor = item.id;
                label.textContent = item.name;

                const select = document.createElement('select');
                select.id = item.id;
                select.name = item.id; // 記号を含まないIDをname属性に使用
                select.required = true;

                // 未選択状態のプレースホルダーを追加
                const placeholderOption = document.createElement('option');
                placeholderOption.value = "";
                placeholderOption.textContent = "残数を選択";
                placeholderOption.disabled = true;
                placeholderOption.selected = true;
                select.appendChild(placeholderOption);

                // 在庫数の選択肢 (0から100まで)
                for (let i = 0; i <= 100; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    select.appendChild(option);
                }

                listItem.appendChild(label);
                listItem.appendChild(select);
                // Netlify通知で1行=「項目名: 数量」にするため、品名をnameにしたhiddenを同梱
                const hidden = document.createElement('input');
                hidden.type = 'hidden';
                hidden.name = item.name; // フィールド名=品名
                hidden.value = '';
                select.addEventListener('change', () => {
                    hidden.value = select.value || '0';
                });
                listItem.appendChild(hidden);
                itemList.appendChild(listItem);
            });

        });
    </script>
</body>
</html>
